"use strict";(self["webpackChunkwebapp"]=self["webpackChunkwebapp"]||[]).push([[633],{5053:function(e,t,s){s.r(t),s.d(t,{default:function(){return c}});var o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"home"},[t("el-container",{staticClass:"home-container"},[t("el-header",[t("div",{staticClass:"header_logo"},[t("img",{attrs:{alt:"logo",src:"/images/logo.png"}})]),t("div",{staticClass:"header_ver"},[t("span",[e._v(e._s(e.appName)+" SDK: "+e._s(e.sdkVersion))])]),t("div",[t("el-divider",{attrs:{direction:"vertical"}})],1),t("div",{staticClass:"header_nav"},[t("el-menu",{attrs:{router:"","default-active":e.activePath,mode:"horizontal","background-color":"#4c4c4c","text-color":"#fff","active-text-color":"#fff"},on:{select:e.handleSelect}},[t("el-menu-item",{staticStyle:{height:"50px","line-height":"50px"},attrs:{index:"/preview"},on:{click:function(t){return e.saveNavState("/preview")}}},[e._v("Preview")]),t("el-menu-item",{staticStyle:{height:"50px","line-height":"50px"},attrs:{index:"/setting"},on:{click:function(t){return e.saveNavState("/setting")}}},[e._v("Configure")])],1)],1),t("div",{staticClass:"header_right",attrs:{align:"right"}},[t("el-select",{staticClass:"mode-select",staticStyle:{width:"150px"},attrs:{size:"mini"},model:{value:e.mode_option_data,callback:function(t){e.mode_option_data=t},expression:"mode_option_data"}},e._l(e.mode_options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),t("i",{staticClass:"el-icon-s-custom"}),t("span",[e._v("admin")]),t("el-tooltip",{attrs:{effect:"dark",content:"Logout",placement:"bottom-end",enterable:!1}},[t("el-button",{attrs:{type:"text",icon:"el-icon-switch-button"},on:{click:e.logout}})],1)],1)]),t("el-main",{staticClass:"main-container"},[t("router-view",{attrs:{mode_option:e.mode_option_data,home_dual_mode:e.sns_mode,pano_sns_id:e.pano_snsId,sensor_select:e.sns_Select}})],1)],1)],1)},a=[],n=(s(7658),{data(){return{appName:"--",appVersion:"--",sdkVersion:"--",activePath:"/preview",mode_options:[{label:"Normal Mode",value:"normal"},{label:"AI Mode",value:"ai"}],mode_option_data:"normal",sns_mode:parseInt(window.sessionStorage.getItem("snsMode")),pano_snsId:parseInt(window.sessionStorage.getItem("panoSnsId")),sns_Select:parseInt(window.sessionStorage.getItem("snsSelect")),isForceStop:!1}},created(){var e=window.sessionStorage.getItem("reloadFlag");if("true"==e)return window.sessionStorage.setItem("reloadFlag","false"),void window.location.reload(!0);console.log("home created ++");var t=window.location.href;t=t.substring(0,t.indexOf("/#/")+1)+"action",this.$http.defaults.baseURL=t,this.getInfo();var s=window.sessionStorage.getItem("homeActivePath");s&&(this.activePath=s),console.log("home:",this.activePath),this.$router.path!==this.activePath&&this.$router.push(this.activePath),this.isForceStop=!1,this.startRecvEvents(),console.log("home created --")},methods:{async getInfo(){try{const{data:e}=await this.$http.get("setting/system");console.log("home page, system get return: ",e),200===e.meta.status&&(this.appName=e.data.appName,this.appVersion=e.data.appVersion,this.sdkVersion=e.data.sdkVersion)}catch(e){this.$message.error("Failed to get information")}},handleSelect(e,t){console.log(e,t)},logout(){window.sessionStorage.clear(),this.isForceStop=!0,this.stopRecvEvents(),this.$router.push("/login")},saveNavState(e){window.sessionStorage.setItem("homeActivePath",e)},startRecvEvents(){console.log("[home] startRecvEvents ++"),this.stopRecvEvents();const e=window.sessionStorage.getItem("token");var t="ws://"+window.location.host+"/ws/events?token="+e,s="binary";this.wsEvents=new WebSocket(t,s),this.wsEvents.onopen=()=>{console.log("[home] ws events connected"),this.createEventstimer()},this.wsEvents.onclose=e=>{console.log("[home] ws events disconnected",e),this.isForceStop||this.startRecvEvents()},this.wsEvents.onmessage=e=>{if("string"===typeof e.data)console.log("[home] got a ws events message: "+e.data);else try{var t=new FileReader;t.onload=e=>{if(e.target.readyState===FileReader.DONE){console.log("[home] got a event: "+e.target.result);for(var t=JSON.parse(e.target.result),s=0;s<t.events.length;s++)0===t.events[s].type?this.getInfo():4===t.events[s].type&&this.logout()}},t.readAsText(e.data)}catch(s){console.log("[home] ws events catch except: "+s)}},this.wsEvents.onerror=e=>{console.log("[home] ws events occure error",e)},console.log("[home] startRecvEvents --")},stopRecvEvents(){console.log("[home] stopRecvEvents ++"),this.clearEventstimer(),this.wsEvents&&this.wsEvents.close(),console.log("[home] stopRecvEvents --")},createEventstimer(){this.clearEventstimer(),this.timerEvents=setInterval((()=>{this.wsEvents&&this.wsEvents.send("keep-alive")}),3e3)},clearEventstimer(){this.timerEvents&&(clearInterval(this.timerEvents),this.timerEvents=void 0)}}}),i=n,r=s(1001),l=(0,r.Z)(i,o,a,!1,null,"a3bd5ed0",null),c=l.exports}}]);